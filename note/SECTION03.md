# 섹션 3

> 변하는 부분과 변하지 않는 부분을 잘 분리하는 것이다.

## 템플릿 메서드 패턴
### 목적
작업에서 알고리즘의 골격을 정의하고 일부 단계를 하위 클래스로 연기한다. 
템플릿 메서드를 사용하면 하위 클래스가 알고리즘의 구조를 변경하지 않고도 알고리즘의 특정 단계를 재정의할 수 있다. [GoF]

### 단점
템플릿 메서드 패턴은 상속을 사용한다. 따라서 상속에서 오는 단점을 그대로 가져간다.
특히 자식 클래스가 부모 클래와 컴파일 시점에 강하게 결합되는 문제가 있다.

## 전략 패턴
전략 패턴은 변하지 않는 부분을 `Context` 라는 곳에 두고, 변하는 부분을 `Strategy 라는 인터페이스를 만들고 해당 인터페이스를 구현하도록 해서 문제를 해결한다.
상속이 아니라 위임으로 문제를 해결하는 것이다.

> GoF 디자인 패턴에서 정의한 전략 패턴의 의도는 다음과 같다.
> 알고리즘 제품군을 정의하고 각각을 캡술화하여 상호 교환 간으하게 만들자. 전략을 사용하면 알고리즘을 사용하는 클라이언트와 독립적으로 알고리즘을 변경할 수 있다.

### 선 조립, 후 실행
스프링으로 애플리케이션을 개발할 때 애플리케이션 로딩 시점에 의존관계 주입을 통해 필요한 의존관계를 모두 맺어두고 다음에 실제 요청을 처리하는 것과 같은 원리이다.
이 방식의 단점은 **조립한 이후에는 전략을 변경하기가 번거롭다**는 점이다.

### 인수 전달방식
실행할 때마다 전략을 유연하게 변경할 수 있다.
이 방식의 단점은 **실행할 때마다 전략을 계속 지정**해주어야 한다는 점이다.

## 템플릿 콜백 패턴
변하지 않는 부분을 **템플릿**, 그 템플릿 안에서 변하는 부분에 약간 다른 코드조각을 넘겨서 실행하는 것이 목적이다.  
스프링에서는 **ContextV2** 와 같은 방식의 전략 패턴을 템플릿 콜백 패턴이라 한다.  
스프링에서는 JdbcTemplate, RestTemplate, TransactionTemplate, RedisTemplate 처럼 다양한 템플릿 콜백 패턴이 사용된다.

> 콜백 정의
> 프로그래밍에서 콜백(callback) 또는 콜애프터 함수(call-after function)는 다른 코드의 인수로서 넘겨주는 실행 가능한 코드를 말한다. 
> 콜백을 넘겨받는 코드는 이 콜백을 필요에 따라 즉시 실행할 수도 있고, 아니면 나중에 실행할 수도 있다. [위키백과]

### 자바에서의 콜백은?
* 자바 언어에서 실행 가능한 코드를 인수로 넘기려면 객체가 필요하다. 자바8부터는 람다를 사용할 수 있다.
* 자바 8 이전에는 보통 하나의 메소드를 가진 인터페이스를 구현하고, 주로 익명 내부 클래스를 사용했다.
* 최근에는 주로 람다를 사용한다.

-----
**좋은 설계란?**
> 좋은 설계라는 것은 무엇일까? 수 많은 정의가 있겠지만 진정한 좋은 설계는 바로 **변경**이 일어날 때 자연스럽게 드러난다.  
> **단일 책임 원칙(SRP)** 을 지키면서 변경에 쉽게 대처할 수 있는 구조를 만드는 것이다.

-----
### 익명 클래스
자바의 익명클래스(Anonymous Class)  
부모클래스의 인스턴스를 생성하면서 중괄호{}를 넣고 그 안에 처리구문을 넣어주면 된다. 이때 부모클래스의 메소드를 오버라이드 해주면 된다.
```java
AbstractTemplate template2 = new AbstractTemplate() {
    @Override
    protected void call() {
        log.info("비지니스 로직2 실행");
    }
};
```
 